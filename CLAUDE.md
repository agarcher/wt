# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build & Development Commands

```bash
make build          # Build for current platform (outputs to build/wt)
make test           # Run tests with verbose output
make lint           # Run go vet and golangci-lint
make install        # Install to /usr/local/bin
make build-all      # Cross-compile for darwin/linux amd64/arm64
```

Run a single test:
```bash
go test -v -run TestName ./internal/commands/
```

## Architecture

`wt` is a Git worktree manager CLI built with Go and Cobra. It manages worktree lifecycle with hooks.

### Package Structure

- **cmd/wt/main.go** - Entry point, delegates to `commands.Execute()`
- **internal/commands/** - Cobra command implementations (create, delete, list, cd, exit, init, root)
- **internal/config/** - Loads and parses `.wt.yaml` configuration files
- **internal/git/** - Wraps `git worktree` commands, parses porcelain output
- **internal/hooks/** - Executes lifecycle hooks (pre_create, post_create, pre_delete, post_delete)
- **internal/shell/** - Generates shell integration functions for zsh/bash/fish

### Key Design Patterns

**Shell Integration**: The binary outputs paths; a shell wrapper function (`wt()`) generated by `wt init <shell>` handles the actual `cd`. This solves the subprocess directory change limitation.

**Repository Detection**: Determines if running in main repo vs worktree by checking if `.git` is a file (worktree) or directory (main repo).

**Hook Environment**: Hooks receive standardized env vars: `WT_NAME`, `WT_PATH`, `WT_BRANCH`, `WT_REPO_ROOT`, `WT_WORKTREE_DIR`, `WT_INDEX`.

**Worktree Index**: Each worktree gets a stable numeric index (1+) stored in `.git/worktrees/<name>/wt-index`. Useful for port offsets and resource isolation.

**Version Injection**: Version set at build time via LDFLAGS: `-X github.com/agarcher/wt/internal/commands.Version=$(VERSION)`

**Cobra Output**: `cmd.Println()` writes to stderr. For stdout output (paths, listings), use `fmt.Fprintln(cmd.OutOrStdout(), ...)`.

## Git Workflow

**Never squash or rebase on merge.** Always use `gh pr merge --merge`.
